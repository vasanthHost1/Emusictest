<!DOCTYPE html>
<html>
<head>
  <title>Foxxy Music üé∂</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    input[type="text"] {
      padding: 10px;
      width: 60%;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: green;
      color: black;
      cursor: pointer;
      margin: 5px;
    }
    #thumbnail {
      margin-top: 10px;
      max-width: 300px;
      border-radius: 12px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Foxxy Music üéµ</h1>
  <input type="text" id="searchInput" placeholder="Enter song title (e.g., Perfect Ed Sheeran)">
  <button onclick="searchSong()">Search</button>
  <br>
  <div id="videoTitle"></div>
  <img id="thumbnail" src="" id="thumbnail">
  <br>
  <button onclick="playVideo()">‚ñ∂Ô∏è Play</button>
  <button onclick="pauseVideo()">‚è∏ Pause</button>
  <br><br>

  <div id="player" style="position:absolute; left:-9999px;"></div>

  <script>
    let player, currentTitle = "";
    const API_KEYS = [
      "AIzaSyA6HuHCZSivAGvISxA4h3EglIQJgmee66k",
      "AIzaSyCkUWUbVYjZDNRhNJBJ-NkN8ta3ga4vY3Y",
      "AIzaSyD8TitWTpspygPuDnbilqeaLj9AG1krL48"
    ];
    let keyIndex = 0;
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzEhvARdMVq6W7srYh2L4aSSsc5DKyDsKAcVIUJ7D9prEUCM5nl8ibFXuDpHgNRBZvG/exec";

    function getApiKey() {
      const key = API_KEYS[keyIndex];
      keyIndex = (keyIndex + 1) % API_KEYS.length;
      return key;
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: '',
        events: {
          'onReady': () => console.log('YT Ready')
        }
      });
    }

    function playVideo() {
      if (player) player.playVideo();
    }

    function pauseVideo() {
      if (player) player.pauseVideo();
    }

    function searchSong() {
      const title = document.getElementById('searchInput').value.trim();
      if (!title) return;

      fetch(SHEET_URL, {
        method: "POST",
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `title=${encodeURIComponent(title)}`
      });

      loadAndPlay(title);
    }

    function loadAndPlay(title) {
      const apiKey = getApiKey();
      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(title)}&key=${apiKey}&type=video&maxResults=1`)
        .then(res => res.json())
        .then(data => {
          const video = data.items[0];
          const videoId = video.id.videoId;
          const videoTitle = video.snippet.title;
          const thumb = video.snippet.thumbnails.medium.url;

          document.getElementById('videoTitle').innerText = videoTitle;
          document.getElementById('thumbnail').src = thumb;
          document.getElementById('thumbnail').style.display = 'block';

          player.loadVideoById(videoId);
        });
    }

    function syncLoop() {
      setInterval(() => {
        fetch(SHEET_URL)
          .then(res => res.text())
          .then(title => {
            if (title && title !== currentTitle) {
              currentTitle = title;
              loadAndPlay(title);
            }
          });
      }, 2000);
    }

    // Load YT Player
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    // Start sync
    syncLoop();
  </script>
</body>
</html>
